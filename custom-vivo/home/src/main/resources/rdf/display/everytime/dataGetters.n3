<freemarker:individual--bibo-document.ftl> 
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#hasDataGetter> 
                 <http://vitro.mannlib.cornell.edu/ns/default#authorAffiliationsDataGetter> .

<http://vitro.mannlib.cornell.edu/ns/default#authorAffiliationsDataGetter>
        a       <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#query> """
PREFIX rdfs:     <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd:      <http://www.w3.org/2001/XMLSchema#>
PREFIX owl:      <http://www.w3.org/2002/07/owl#>
PREFIX obo:      <http://purl.obolibrary.org/obo/>
PREFIX bibo:     <http://purl.org/ontology/bibo/>
PREFIX foaf:     <http://xmlns.com/foaf/0.1/>
PREFIX vitro:    <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
PREFIX vivo:     <http://vivoweb.org/ontology/core#>

SELECT ?affiliation (GROUP_CONCAT(?rank;separator=";") AS ?ranks) (MIN(?affiliationName_) AS ?affiliationName) 
(MIN(?rank) AS ?minRank)
WHERE {  
{
SELECT ?rank (COALESCE(MIN(?affiliation_), owl:Nothing) AS ?affiliation) WHERE {
  ?individualURI a bibo:Document .
  ?individualURI vivo:relatedBy ?authorship .
  ?authorship a vivo:Authorship .
  ?authorship vivo:rank ?rank .
  ?authorship <http://vivo.deffopera.dk/ontology/osrap/relatedToOrganization> ?affiliation_ .
} GROUP BY ?rank ORDER BY ?rank
}
  ?affiliation rdfs:label ?affiliationName_  
} GROUP BY ?affiliation ORDER BY ?minRank
    """ ;                
	<http://vitro.mannlib.cornell.edu/ontologies/display/1.1#saveToVar>
                "authorAffiliations" .

<freemarker:individual--bibo-document.ftl> 
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#hasDataGetter> 
                 <http://vitro.mannlib.cornell.edu/ns/default#pubMetaDataGetter> .

<http://vitro.mannlib.cornell.edu/ns/default#pubMetaDataGetter>
        a       <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#query> """
PREFIX rdfs:     <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd:      <http://www.w3.org/2001/XMLSchema#>
PREFIX owl:      <http://www.w3.org/2002/07/owl#>
PREFIX obo:      <http://purl.obolibrary.org/obo/>
PREFIX bibo:     <http://purl.org/ontology/bibo/>
PREFIX foaf:     <http://xmlns.com/foaf/0.1/>
PREFIX vitro:    <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
PREFIX vivo:     <http://vivoweb.org/ontology/core#>

SELECT ?typeLabel ?startYear ?endYear ?fundingAmount ?grantNumber
WHERE {
  ?individualURI a vivo:Grant .
  OPTIONAL {
    ?individualURI vivo:totalAwardAmount ?fundingAmount 
  }  
  OPTIONAL {
    ?individualURI vivo:sponsorAwardId ?grantNumber 
  }
  OPTIONAL {
    ?individualURI vivo:dateTimeInterval ?dti .
    ?dti vivo:start ?startDtv .
    ?startDtv vivo:dateTime ?startDateTime .
    BIND(STRBEFORE(STR(?startDateTime), "-") AS ?startYear)
  } 
  OPTIONAL {
    ?individualURI vivo:dateTimeInterval ?dti .
    ?dti vivo:end ?endDtv .
    ?endDtv vivo:dateTime ?endDateTime .
    BIND(STRBEFORE(STR(?endDateTime), "-") AS ?endYear)
  }
  OPTIONAL { 
    ?individualURI vitro:mostSpecificType ?mst .
    ?mst rdfs:label ?typeLabel 
  }
}
    """ ;                
	<http://vitro.mannlib.cornell.edu/ontologies/display/1.1#saveToVar>
                "pubMeta" .

<freemarker:individual--bibo-document.ftl> 
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#hasDataGetter> 
                 <http://vitro.mannlib.cornell.edu/ns/default#supportingGrantDataGetter> .

<http://vitro.mannlib.cornell.edu/ns/default#supportingGrantDataGetter>
        a       <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#query> """
PREFIX rdfs:     <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd:      <http://www.w3.org/2001/XMLSchema#>
PREFIX owl:      <http://www.w3.org/2002/07/owl#>
PREFIX obo:      <http://purl.obolibrary.org/obo/>
PREFIX bibo:     <http://purl.org/ontology/bibo/>
PREFIX foaf:     <http://xmlns.com/foaf/0.1/>
PREFIX vitro:    <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
PREFIX vivo:     <http://vivoweb.org/ontology/core#>

SELECT ?grant ?grantLabel ?funder ?funderLabel ?grantNumber ?awardAmountEur
WHERE {
  ?individualURI vivo:informationResourceSupportedBy ?grant .
  ?grant rdfs:label ?grantLabel .
  OPTIONAL {
    ?grant vivo:assignedBy ?funder .
    ?funder rdfs:label ?funderLabel .
  }
  OPTIONAL {
    ?grant vivo:sponsorAwardId ?grantNumber
  }
  OPTIONAL {
    ?grant vivo:totalAwardAmount ?awardAmountEur
  }
} ORDER BY DESC(?awardAmountEur)
    """ ;                
    <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#saveToVar>
                "supportingGrants" .

# Grant data getters

<freemarker:individual--vivo-grant.ftl> 
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#hasDataGetter> 
                 <http://vitro.mannlib.cornell.edu/ns/default#grantMetaDataGetter> .

<http://vitro.mannlib.cornell.edu/ns/default#grantMetaDataGetter>
        a       <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
        <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#query> """
PREFIX rdfs:     <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd:      <http://www.w3.org/2001/XMLSchema#>
PREFIX owl:      <http://www.w3.org/2002/07/owl#>
PREFIX obo:      <http://purl.obolibrary.org/obo/>
PREFIX bibo:     <http://purl.org/ontology/bibo/>
PREFIX foaf:     <http://xmlns.com/foaf/0.1/>
PREFIX vitro:    <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
PREFIX vivo:     <http://vivoweb.org/ontology/core#>

SELECT ?publisher ?publisherName ?issn ?year ?timesCited ?fieldCitationRatio ?relativeCitationRatio
       ?typeLabel ?openAccess
WHERE {
  ?individualURI a bibo:Document .
  OPTIONAL {
    ?individualURI vivo:publisher ?publisher .
    ?publisher rdfs:label ?publisherName .
  }
  OPTIONAL {
    ?individualURI vivo:hasPublicationVenue ?journal .
    ?journal bibo:issn ?issn .
  }
  OPTIONAL {
    ?individualURI vivo:dateTimeValue ?dtv .
    ?dtv vivo:dateTime ?dateTime .
    BIND(STRBEFORE(STR(?dateTime), "-") AS ?year)
  }
  OPTIONAL {
    ?individualURI <http://vivo.deffopera.dk/ontology/osrap/timesCited> ?timesCited
  }
  OPTIONAL {
    ?individualURI <http://vivo.deffopera.dk/ontology/osrap/fieldCitationRatio> ?fieldCitationRatio
  }
  OPTIONAL {
    ?individualURI <http://vivo.deffopera.dk/ontology/osrap/relativeCitationRatio> ?relativeCitationRatio
  }
  OPTIONAL { 
    ?individualURI vitro:mostSpecificType bibo:AcademicArticle .
    BIND("Article" AS ?typeLabel)
  }
  OPTIONAL {
    ?individualURI <http://vivo.deffopera.dk/ontology/osrap/openAccessCategory> ?openAccess .
    FILTER(?openAccess != <http://vivo.deffopera.dk/individual/open-access-category-closed>)
  }
}
    """ ;                
	<http://vitro.mannlib.cornell.edu/ontologies/display/1.1#saveToVar>
                "grantMeta" .


