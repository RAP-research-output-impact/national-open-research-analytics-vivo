@prefix : <http://vitro.mannlib.cornell.edu/ns/vitro/ApplicationSetup#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# make sure that LabelsAcrossContext nodes applies only to normal vivo:Relationships 
# and not to things like wos:Address that also use relates/relatedBy
:extension_forContextNodes
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Relationship" .

:documentModifier_facet_document-type
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Document type document modifier" ;
    :hasTargetField "facet_document-type_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
        SELECT DISTINCT ?type
        WHERE {
            ?uri vitro:mostSpecificType ?type 
	    FILTER (?type != bibo:Journal)
	    FILTER (?type != bibo:Book)
	    FILTER (?type != wos:Conference)
        }
    """ .

:documentModifier_facet_publication-year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Publication year document modifier" ;
    :hasTargetField "facet_publication-year_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?year
        WHERE {
            ?uri vivo:dateTimeValue ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
        }
    """ .

:documentModifier_facet_organization
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Organization document modifier" ;
    :hasTargetField "facet_organization_ss" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
        SELECT DISTINCT ?org
        WHERE {
	  {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  }
        }
    """ .
:documentModifier_facet_university
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "University document modifier" ;
    :hasTargetField "facet_university_ss" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
        SELECT DISTINCT ?org
        WHERE {
	  {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a vivo:University .
	  } UNION {
            ?uri nora:relatedToOrganizationByDdfDoi ?org .
	    ?org a vivo:University .
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a vivo:University .
	  }
        }
    """ .

:documentModifier_facet_hospital
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Hospital document modifier" ;
    :hasTargetField "facet_hospital_ss" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
        SELECT DISTINCT ?org
        WHERE {
	  {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a vivo:Hospital .
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a vivo:Hospital .
	  }

        }
    """ .

:documentModifier_facet_journal
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Journal document modifier" ;
    :hasTargetField "facet_journal_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?journal
        WHERE {
            ?uri vivo:hasPublicationVenue ?journal .
	    ?journal a bibo:Journal .
        }
    """ .

:documentModifier_facet_retrieval
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Retrieval document modifier" ;
    :hasTargetField "facet_retrieval_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?retrieval
        WHERE {
            ?uri <http://vivo.deffopera.dk/ontology/osrap/retrievedFromDimensionsByDdfDoi> ?something .
	    BIND("by DDF DOI" AS ?retrieval)
        }
    """ .


:uriFinder_facet_publication-year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.IndexingUriFinder> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.SelectQueryUriFinder> ;
    rdfs:label "Organization-enhanced uri finder" ;
    :hasPredicateRestriction "http://vivoweb.org/ontology/core#dateTime" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?uri
        WHERE {
            ?uri vivo:dateTimeValue ?subject .
        }
    """ .

:documentModifier_facet_funder
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Funder document modifier" ;
    :hasTargetField "facet_funder_ss" ;
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant";
    :hasSelectQuery """
	PREFIX vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
        SELECT DISTINCT ?funder
        WHERE {
            ?uri a vivo:Grant .
	    ?uri vivo:assignedBy ?funder .
        }
    """ .


