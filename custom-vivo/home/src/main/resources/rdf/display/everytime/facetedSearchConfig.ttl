@prefix : <http://vitro.mannlib.cornell.edu/ns/vitro/ApplicationSetup#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# make sure that LabelsAcrossContext nodes applies only to normal vivo:Relationships 
# and not to things like wos:Address that also use relates/relatedBy
:extension_forContextNodes
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Relationship" .

:documentModifier_facet_content-type
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Content type document modifier" ;
    :hasTargetField "facet_content-type_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX obo: <http://purl.obolibrary.org/obo/> 
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?contentType
        WHERE {
            { 
	        ?uri a obo:IAO_0000030 .
	        FILTER NOT EXISTS { ?uri a bibo:Patent }
	        FILTER NOT EXISTS { ?uri a vivo:Dataset }
	        BIND("publications" AS ?contentType)
	    }
	    UNION 
	    {
	        ?uri a vivo:Grant .
		BIND("grants" AS ?contentType)

	    }
	    UNION
	    {
                ?uri a vivo:Dataset .
		BIND("datasets" AS ?contentType)
	    }
	    UNION 
	    {
                ?uri a bibo:Patent .
		BIND("patents" AS ?contentType)
	    }
	    UNION
	    {
                ?uri a obo:ERO_0000016
		BIND("clinical_trials" AS ?contentType)
	    }
        }
    """ .

:documentModifier_facet_document-type
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Document type document modifier" ;
    :hasTargetField "facet_document-type_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
        SELECT DISTINCT ?type
        WHERE {
            ?uri vitro:mostSpecificType ?type 
	    FILTER (?type != bibo:Journal)
        }
    """ .

:documentModifier_facet_year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Year document modifier" ;
    :hasTargetField "facet_year_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
        SELECT DISTINCT ?year
        WHERE {
	  {
            ?uri vivo:dateTimeValue ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
	    FILTER NOT EXISTS { ?uri a <http://purl.org/ontology/bibo/Patent> }
	  }
	  UNION
	  {
            ?uri <http://vivo.deffopera.dk/ontology/osrap/activeYear> ?year
	  } 
	  UNION
	  {
            ?uri vivo:dateIssued ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
	  }
	  FILTER( (xsd:integer(?year) >= 2014) && (xsd:integer(?year) <= 2017) )
        }
    """ .

:documentModifier_sort_year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Sort year document modifier" ;
    :hasTargetField "sort_year_s" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
        SELECT (MAX(?year) AS ?maxYear)
        WHERE {
	  {
            ?uri vivo:dateTimeValue ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
	    FILTER NOT EXISTS { ?uri a <http://purl.org/ontology/bibo/Patent> }
	  }
	  UNION
	  {
            ?uri <http://vivo.deffopera.dk/ontology/osrap/activeYear> ?year
	  } 
	  UNION
	  {
            ?uri vivo:dateIssued ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
	  }
	  FILTER( (xsd:integer(?year) >= 2014) && (xsd:integer(?year) <= 2017) )
        } GROUP BY ?uri
    """ .



:documentModifier_facet_publication-year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Publication year document modifier" ;
    :hasTargetField "facet_publication-year_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?year
        WHERE {
            ?uri vivo:dateTimeValue ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
	    FILTER NOT EXISTS { ?uri a <http://purl.org/ontology/bibo/Patent> }
        }
    """ .

:documentModifier_facet_start-year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Start year document modifier" ;
    :hasTargetField "facet_start-year_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?year
        WHERE {
            ?uri vivo:dateTimeInterval ?dti .
	    ?dti vivo:start ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
        }
    """ .

:documentModifier_facet_granted-year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Granted year document modifier" ;
    :hasTargetField "facet_granted-year_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?year
        WHERE {
            ?uri vivo:dateIssued ?dtv .
	    ?dtv vivo:dateTime ?dateTime .
	    BIND(substr(str(?dateTime), 1, 4) AS ?year)
        }
    """ .

:documentModifier_facet_organization-all
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "ALl organization (parent facet) document modifier" ;
    :hasTargetField "facet_organization-all_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
	PREFIX obo: <http://purl.obolibrary.org/obo/> 
	PREFIX abox:     <http://vivo.deffopera.dk/individual/>
        SELECT DISTINCT ?org
        WHERE {
	  FILTER(REGEX(STR(?org), "grid"))
	  { 
	    ?uri a obo:IAO_0000030 .
            ?uri bibo:doi ?doi .
	    ?ddf nora:doi ?doi .
	    ?ddf a nora:DDF .
	    ?ddf nora:grid ?grid .
	    BIND(IRI(CONCAT(STR(abox:), ?grid)) AS ?org)
	  } UNION {
	    ?uri a obo:IAO_0000030 .
	    ?uri nora:relatedToOrganization ?org .
	  } UNION {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	  } UNION {
            ?uri a obo:ERO_0000016 . # ClinicalTrial
	    ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	  } UNION {
            ?uri nora:assigneeOriginal ?org .
	    ?org a foaf:Organization .
	  }
        }
    """ .

:documentModifier_facet_country
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Country document modifier" ;
    :hasTargetField "facet_country_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX obo: <http://purl.obolibrary.org/obo/>
	PREFIX abox:     <http://vivo.deffopera.dk/individual/>
        SELECT DISTINCT ?country
        WHERE {
	  FILTER(REGEX(STR(?org), "grid"))
	  { 
            ?uri bibo:doi ?doi .
	    ?ddf nora:doi ?doi .
	    ?ddf a nora:DDF .
	    ?ddf nora:grid ?grid .
	    BIND(IRI(CONCAT(STR(abox:), ?grid)) AS ?org)
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	  } UNION {
	    ?uri a obo:IAO_0000030 .
	    ?uri nora:relatedToOrganization ?org .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	  } UNION {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	  } UNION {
            ?uri a obo:ERO_0000016 . # ClinicalTrial
	    ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	  } UNION {
            ?uri nora:assigneeOriginal ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	  }
        }
    """ .

:documentModifier_facet_continent
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Continent document modifier" ;
    :hasTargetField "facet_continent_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
	PREFIX obo: <http://purl.obolibrary.org/obo/> 
	PREFIX abox:     <http://vivo.deffopera.dk/individual/>
        SELECT DISTINCT ?continent
        WHERE {
	  FILTER(REGEX(STR(?org), "grid"))
	  { 
            ?uri bibo:doi ?doi .
	    ?ddf nora:doi ?doi .
	    ?ddf a nora:DDF .
	    ?ddf nora:grid ?grid .
	    BIND(IRI(CONCAT(STR(abox:), ?grid)) AS ?org)
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#isInGroup> ?continent .
	    ?continent a vivo:Continent .
	  } UNION {
	    ?uri a obo:IAO_0000030 .
	    ?uri nora:relatedToOrganization ?org .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#isInGroup> ?continent .
	    ?continent a vivo:Continent .
	  } UNION {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#isInGroup> ?continent .
	    ?continent a vivo:Continent .
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#isInGroup> ?continent .
	    ?continent a vivo:Continent .
	  } UNION {
            ?uri a obo:ERO_0000016 . # ClinicalTrial
	    ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#isInGroup> ?continent .
	    ?continent a vivo:Continent .
	  } UNION {
            ?uri nora:assigneeOriginal ?org .
	    ?org a foaf:Organization .
	    ?org nora:countryCode ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#codeISO2> ?countryCode .
	    ?country <http://aims.fao.org/aos/geopolitical.owl#isInGroup> ?continent .
	    ?continent a vivo:Continent .
	  }
        }
    """ .

:documentModifier_facet_organization
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Organization document modifier" ;
    :hasTargetField "facet_organization_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
	PREFIX obo: <http://purl.obolibrary.org/obo/> 
	PREFIX abox:     <http://vivo.deffopera.dk/individual/>
        SELECT DISTINCT ?org
        WHERE {
	  FILTER(REGEX(STR(?org), "grid"))
	  { 
            ?uri bibo:doi ?doi .
	    ?ddf nora:doi ?doi .
	    ?ddf a nora:DDF .
	    ?ddf nora:grid ?grid .
	    BIND(IRI(CONCAT(STR(abox:), ?grid)) AS ?org)
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  } UNION {
	    ?uri nora:relatedToOrganization ?org .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  } UNION {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  } UNION {
            ?uri a obo:ERO_0000016 . # ClinicalTrial
	    ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a foaf:Organization .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  } UNION {
            ?uri nora:assigneeOriginal ?org .
	    ?org a foaf:Organization .
	    FILTER NOT EXISTS { ?org a vivo:University }
	    FILTER NOT EXISTS { ?org a vivo:Hospital }
	  }
        }
    """ .

:documentModifier_facet_university
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "University document modifier" ;
    :hasTargetField "facet_university_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
	PREFIX obo: <http://purl.obolibrary.org/obo/> 
	PREFIX abox:     <http://vivo.deffopera.dk/individual/>
        SELECT DISTINCT ?org
        WHERE {
	  {
            ?uri bibo:doi ?doi .
	    ?ddf nora:doi ?doi .
	    ?ddf a nora:DDF .
	    ?ddf nora:grid ?grid .
	    BIND(IRI(CONCAT(STR(abox:), ?grid)) AS ?org)
	    ?org a vivo:University .
	  } UNION {
	    ?uri nora:relatedToOrganization ?org .
	    ?org a vivo:University .
	  } UNION {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a vivo:University .
	  } UNION {
            ?uri nora:relatedToOrganizationByDdfDoi ?org .
	    ?org a vivo:University .
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a vivo:University .
	  } UNION {
            ?uri a obo:ERO_0000016 . # ClinicalTrial
	    ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a vivo:University .
	  } UNION {
            ?uri nora:assigneeOriginal ?org .
	    ?org a vivo:University .
	  }
        }
    """ .

:documentModifier_facet_hospital
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Hospital document modifier" ;
    :hasTargetField "facet_hospital_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
	PREFIX obo: <http://purl.obolibrary.org/obo/> 
	PREFIX abox:     <http://vivo.deffopera.dk/individual/>
        SELECT DISTINCT ?regionAlias
        WHERE {
	  {
            ?uri bibo:doi ?doi .
	    ?ddf nora:doi ?doi .
	    ?ddf a nora:DDF .
	    ?ddf nora:grid ?grid .
	    BIND(IRI(CONCAT(STR(abox:), ?grid)) AS ?org)
	    ?org a vivo:Hospital .
	    ?org vivo:abbreviation ?regionAlias
	  } UNION {
	    ?uri nora:relatedToOrganization ?org .
	    ?org a vivo:Hospital .
	    ?org vivo:abbreviation ?regionAlias
	  } UNION {
            ?authorship vivo:relates ?uri .
	    ?authorship a vivo:Authorship .
	    ?authorship nora:relatedToOrganization ?org .
	    ?org a vivo:Hospital .
	    ?org vivo:abbreviation ?regionAlias
	  } UNION {
            ?uri a vivo:Grant .
	    ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a vivo:Hospital .
	    ?org vivo:abbreviation ?regionAlias
	  } UNION {
            ?uri a obo:ERO_0000016 . # ClinicalTrial
	    ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 .
	    ?role nora:relatedToOrganization ?org .
	    ?org a vivo:Hospital .
	    ?org vivo:abbreviation ?regionAlias
	  } UNION {
            ?uri nora:assigneeOriginal ?org .
	    ?org a vivo:Hospital .
	    ?org vivo:abbreviation ?regionAlias
	  }
        }
    """ .


:documentModifier_facet_contributor
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Contributor document modifier" ;
    :hasTargetField "facet_contributor_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
        PREFIX obo:  <http://purl.obolibrary.org/obo/>
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
	PREFIX foaf: <http://xmlns.com/foaf/0.1/>
        SELECT DISTINCT ?agent
        WHERE {
	  {
            ?uri vivo:relatedBy ?authorship .
	    ?authorship a vivo:Authorship .
	    ?authorship vivo:relates ?agent .
	    ?agent a foaf:Agent .
	  } UNION {
            ?uri vivo:relates ?role .
	    ?role a obo:BFO_0000023 . # Role
	    ?role obo:RO_0000052 ?agent . # inheresIn
	    ?agent a foaf:Agent .
	  } UNION {
            ?uri obo:BFO_0000055 ?role .
	    ?role a obo:BFO_0000023 . # Role
	    ?role obo:RO_0000052 ?agent . # inheresIn
	    ?agent a foaf:Agent .
	  }
        }
    """ .

:documentModifier_facet_journal
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Journal document modifier" ;
    :hasTargetField "facet_journal_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?journal
        WHERE {
            ?uri vivo:hasPublicationVenue ?journal .
	    ?journal a bibo:Journal .
        }
    """ .

:documentModifier_facet_publisher
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Publisher document modifier" ;
    :hasTargetField "facet_publisher_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?publisher
        WHERE {
            ?uri vivo:publisher ?publisher .
        }
    """ .

:documentModifier_facet_open-access
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Open access document modifier" ;
    :hasTargetField "facet_open-access_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?openAccess
        WHERE {
            ?uri <http://vivo.deffopera.dk/ontology/osrap/openAccessCategory> ?openAccess .
        }
    """ .

:documentModifier_facet_respository
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Repository document modifier" ;
    :hasTargetField "facet_repository_ss" ;
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Dataset" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?repository
        WHERE {
	    ?uri a vivo:Dataset .
            ?uri vivo:hasPublicationVenue ?repository .
        }
    """ .

:documentModifier_facet_grant-status
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Grant status document modifier" ;
    :hasTargetField "facet_grant-status_ss" ;
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?status
        WHERE {
	    ?uri a vivo:Grant .
            ?uri bibo:status ?status .
        }
    """ .

:documentModifier_facet_original-assignee
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Original assignee document modifier" ;
    :hasTargetField "facet_original-assignee_ss" ;
    :hasTypeRestriction "http://purl.org/ontology/bibo/Patent" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?originalAssignee
        WHERE {
	    ?uri <http://vivo.deffopera.dk/ontology/osrap/assigneeOriginal> ?originalAssignee .
        }
    """ .

:documentModifier_facet_jurisdiction
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Jurisdiction document modifier" ;
    :hasTargetField "facet_jurisdiction_ss" ;
    :hasTypeRestriction "http://purl.org/ontology/bibo/Patent" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?jurisdiction
        WHERE {
	    ?uri <http://vivo.deffopera.dk/ontology/osrap/jurisdiction> ?jurisdiction .
        }
    """ .

:documentModifier_facet_filing-status
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Filing status document modifier" ;
    :hasTargetField "facet_filing-status_ss" ;
    :hasTypeRestriction "http://purl.org/ontology/bibo/Patent" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?filingStatus
        WHERE {
	    ?uri <http://vivo.deffopera.dk/ontology/osrap/filingStatus> ?filingStatus .
        }
    """ .

:documentModifier_facet_legal-status
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Legal status document modifier" ;
    :hasTargetField "facet_legal-status_ss" ;
    :hasTypeRestriction "http://purl.org/ontology/bibo/Patent" ;
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?legalStatus
        WHERE {
	    ?uri <http://vivo.deffopera.dk/ontology/osrap/legalStatus> ?legalStatus .
        }
    """ .

:documentModifier_facet_phase
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Phase document modifier" ;
    :hasTargetField "facet_phase_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?phase
        WHERE {
	    ?uri <http://purl.obolibrary.org/obo/ERO_0001518> ?phase .
        }
    """ .

:documentModifier_facet_sponsor-collaborator
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Sponsor/collaborator document modifier" ;
    :hasTargetField "facet_sponsor-collaborator_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?sponsorCollaborator
        WHERE {
	    ?uri <http://purl.obolibrary.org/obo/BFO_0000055> ?fundingRole .
	    ?fundingRole a <http://purl.obolibrary.org/obo/ERO_0000224> .
	    ?fundingRole <http://purl.obolibrary.org/obo/RO_0000052> ?sponsorCollaborator .
        }
    """ .

:documentModifier_facet_retrieval
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Retrieval document modifier" ;
    :hasTargetField "facet_retrieval_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/> 
        SELECT DISTINCT ?retrieval
        WHERE {
	  {
            ?uri bibo:doi ?doi .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/doi> ?doi .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/dim_ddf> "true" .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/dim_grid> "true" .
	    BIND("GRID and DDF" as ?retrieval)
	  } UNION {
            ?uri bibo:doi ?doi .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/doi> ?doi .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/dim_ddf> "true" .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/dim_grid> "false" .
	    BIND("DDF only" AS ?retrieval)
	  }
            ?uri bibo:doi ?doi .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/doi> ?doi .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/dim_ddf> "false" .
	    ?flagSet <http://vivo.deffopera.dk/ontology/osrap/dim_grid> "true" .
	    BIND("GRID only" AS ?retrieval)
	  }
        }
    """ .

:documentModifier_facet_sdg
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Sustainable development goals document modifier" ;
    :hasTargetField "facet_sdg_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/>
	PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT DISTINCT ?sdg
        WHERE {
            ?uri vivo:hasSubjectArea ?sdg .
	    ?sdg a <http://vivo.deffopera.dk/ontology/osrap/CategorySDG> .
	    ?sdg rdfs:label ?label .
        }
    """ .

:documentModifier_facet_research-category
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Research category document modifier" ;
    :hasTargetField "facet_research-category_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/>
	PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT DISTINCT ?for
        WHERE {
            ?uri vivo:hasSubjectArea ?for .
	    ?for a <http://vivo.deffopera.dk/ontology/osrap/CategoryFOR> .
	    ?for rdfs:label ?label .
	    FILTER(REGEX(STR(?label), "^[0-9][0-9] "))
        }
    """ .

:documentModifier_facet_main-subject-area
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Research category document modifier" ;
    :hasTargetField "facet_main-subject-area_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo: <http://purl.org/ontology/bibo/>
	PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        SELECT DISTINCT ?subjectArea 
        WHERE {
            ?uri vivo:hasSubjectArea ?for .
	    ?for skos:broader ?subjectArea .
	    ?subjectArea a <http://vivo.deffopera.dk/ontology/osrap/NORASubjectArea> .
        }
    """ .

:uriFinder_facet_publication-year
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.IndexingUriFinder> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.SelectQueryUriFinder> ;
    rdfs:label "Publication year uri finder" ;
    :hasPredicateRestriction "http://vivoweb.org/ontology/core#dateTime" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?uri
        WHERE {
            ?uri vivo:dateTimeValue ?subject .
        }
    """ .

:documentModifier_facet_funder
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
            <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "Funder document modifier" ;
    :hasTargetField "facet_funder_ss" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/IAO_0000030";
    :hasTypeRestriction "http://vivoweb.org/ontology/core#Grant" ;
    :hasTypeRestriction "http://purl.obolibrary.org/obo/ERO_0000016" ; # ClinicalTrial
    :hasSelectQuery """
	PREFIX vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
	PREFIX vivo: <http://vivoweb.org/ontology/core#>
	PREFIX bibo:   <http://purl.org/ontology/bibo/>
	PREFIX wos: <http://webofscience.com/ontology/wos#> 
	PREFIX nora:    <http://vivo.deffopera.dk/ontology/osrap/>
        SELECT DISTINCT ?funder
        WHERE {
	  {
            ?uri a vivo:Grant .
	    ?uri vivo:assignedBy ?funder .
	  } UNION {
            ?uri vivo:informationResourceSupportedBy ?grant .
	    ?grant a vivo:Grant .
	    ?grant vivo:assignedBy ?funder .
	  } UNION {
            ?uri nora:funder ?funder .
	  }
        }
    """ .


